<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ç…§é¡§è²“å´é›ª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #pet-container {
      width: 450px;
      max-height: 760px;
      padding: 10px;
      background-image: url('https://i.postimg.cc/fW2cfqqw/room-nobody-background-solid-color-6958f02a-8703-442b-b258-5bb3ab9e5966.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      position: relative;
      overflow-y: auto;
      color: #222;
      box-sizing: border-box;
<img id="rolling-cat" src="https://media.tenor.com/x2dtLa1zBQ0AAAAj/%E8%B2%93%E8%B2%93-%E8%B2%93%E5%92%AA.gif" alt="æ‰“æ»¾çš„è²“" />

}


    #clock {
      position: absolute;
      font-weight: bold;         /* åŠ ç²— */
      box-shadow: 0 0 5px rgba(0,0,0,0.1); /* å¾®é™°å½± */
      top: 10px; left: 15px;
      font-size: 13px;
      color: #555;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }
    h1 {
      font-size: 18px;
      text-align: center;
      margin-top: 20px;
      margin-bottom: 0px;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
      position: relative;
      top: -10px;
    }

    #mood-bubble {
      position: absolute;
      top: 45px; right: 15px;
      background-color: rgba(255, 249, 196, 0.9);
      padding: 8px 12px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      font-size: 14px;
      display: none;
      max-width: 60%;
      z-index: 10;
    }
    #status {
      margin-top: 15px;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 10px;
      padding: 12px 15px;
      color: #222;
position: relative;
  top: -10px; /* å‘ä¸Šåç§» 10px */
    }
    #status p, #status .status-label {
      font-size: 12px;
      margin: 4px 0;
    }
    .status-label {
      font-weight: bold;
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .status-bar {
      background-color: #ccc;
      border-radius: 5px;
      height: 8px;
      margin-top: 3px;
      overflow: hidden;
    }
    .status-fill {
      height: 100%;
      border-radius: 5px;
      width: 0;
      transition: width 0.3s ease;
    }
    #hunger-bar { background-color: #ff7043; }
    #thirst-bar { background-color: #26c6da; }
    #energy-bar { background-color: #42a5f5; }
    #exp-bar { background-color: #66bb6a; }

    /* æŠŠç­‰ç´šå’Œé‡‘å¹£æ”¾ä¸€èµ·ï¼ŒèƒŒæ™¯è‰²æ”¹ç°è‰²æ·¡æ·¡ */
    #level-coins {
      margin-top: 10px;
      font-weight: bold;         /* åŠ ç²— */
      box-shadow: 0 0 5px rgba(0,0,0,0.1), inset 0 0 5px #ccc; /* å¾®é™°å½± */
      background: #f0f0f0;
      border-radius: 10px;
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #222;
    }

    #actions {
      margin-top: 15px;
      text-align: center;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    button {
      margin: 4px;
      padding: 5px 10px;
      font-size: 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: #000;
      min-width: 80px;
      user-select: none;
      transition: background-color 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    #play-btn { background-color: #4CAF50; }
    #feed-btn { background-color: #ff9800; }
    #clean-btn { background-color: #2196F3; }
    #drink-btn { background-color: #00acc1; }
    #sleep-btn { background-color: #a668d3; }
    #coin-btn { background-color: #99dd6e; color: #333; }
    #buy-coin-btn { background-color: #fe9882; color: #000; }  
    #message {
      margin-top: 12px;
      font-weight: bold;
      text-align: center;      
      min-height: 10px;
      color: #333;
      font-size: 13px;
      text-shadow: 1px 1px 2px #fff;
    }

#next-restore-times {
  font-size: 10px;           /* æ”¾å¤§å­—é«” */
  color: #333;               /* è®Šæˆæ·±ç°è‰²æ›´æ¸…æ™° */
  font-weight: bold;         /* åŠ ç²— */
  background-color: rgba(255, 255, 255, 0.7); /* æ·¡ç™½åº• */
  padding: 8px 12px;         /* å…§è· */
  border-radius: 8px;        /* åœ“è§’ */
  margin-top: 12px;
  box-shadow: 0 0 5px rgba(0,0,0,0.1); /* å¾®é™°å½± */
  text-align: center;
}

.inner-content {
  width: 380px;         /* å›ºå®šå¯¬åº¦ */
  margin: 0 auto;       /* ç½®ä¸­ */
}

#dataArea {
  font-size: 12px;
  width: 50%;
  height: 100px;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-top: 8px;
  resize: vertical;
}

#backup-area {
  margin-top: 1px;
  display: flex;           /* æ°´å¹³æ’åˆ— */
  gap: 1px;               /* æŒ‰éˆ•ä¹‹é–“çš„è·é›¢ */
  align-items: center;     /* å‚ç›´ç½®ä¸­ï¼ˆé˜²æ­¢ä¸åŒé«˜åº¦å‡ºç¾éŒ¯ä½ï¼‰ */
  justify-content: flex-start; /* é å·¦å°é½Š */
  flex-wrap: wrap;         /* å¦‚æœç•«é¢å¤ªå°å¯ä»¥è‡ªå‹•æ›è¡Œ */
}

#backup-area button {
  padding: 5px 10px;
  font-size: 12px;
  border: none;
  border-radius: 6px;
  background-color: #7ecfff;
  color: #222;
  cursor: pointer;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: background-color 0.2s ease;
}

#backup-area button:hover {
  background-color: #52b8f6;
}

#rolling-cat {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  width: 120px;
  display: none;
  z-index: 20;
  animation: rollIn 0.8s ease-out;
}

@keyframes rollIn {
  from {
    transform: translateX(-50%) scale(0.8) rotate(-30deg);
    opacity: 0;
  }
  to {
    transform: translateX(-50%) scale(1) rotate(0deg);
    opacity: 1;
  }
}


  </style>
</head>


<body>
  <div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/zh_TW/sdk.js#xfbml=1&version=v23.0"></script>

  <div id="pet-container">
  <div class="inner-content">
    <div id="clock"></div>
    <h1>å…¬å‘Šæ¬„</h1>
  <div style="margin-top: -5px;">
    <iframe src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fnekosaki.yuki%2Fposts%2Fpfbid0Jty2G5ZMtmoBtzqXpYNWqMEdAYi3DuNhvwPbVYJz7pLsRTh2mMhwvUzrV6A7gebFl&width=380&show_text=true&height=582&appId" width="380" height="250" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>


    <div id="mood-bubble"></div>
    <div id="status">
      <p>åå­—: <span id="pet-name">å°é›ª</span></p>
      <p>å¿ƒæƒ…: <span id="mood">é–‹å¿ƒ</span></p>
      <div class="status-label">é£¢é¤“åº¦ <span id="hunger-text">50/100</span></div>
      <div class="status-bar"><div class="status-fill" id="hunger-bar"></div></div>
      <div class="status-label">å£æ¸´å€¼ <span id="thirst-text">40/100</span></div>
      <div class="status-bar"><div class="status-fill" id="thirst-bar"></div></div>
      <div class="status-label">æ´»åŠ› <span id="energy-text">70/100</span></div>
      <div class="status-bar"><div class="status-fill" id="energy-bar"></div></div>
      <div class="status-label">ç¶“é©—å€¼ <span id="exp-text">0/100</span></div>
      <div class="status-bar"><div class="status-fill" id="exp-bar"></div></div>


      <!-- ç­‰ç´šå’Œé‡‘å¹£åˆä½µå€ -->
      <div id="level-coins">
        <span>ç­‰ç´š: <span id="level">1</span></span>
          <span>é‡‘å¹£: <span id="coins">100</span></span>
        </div>

    <div id="next-restore-times">
      ä¸‹ä¸€æ¬¡æ¢å¾©ï¼šç©è€ <span id="next-play">--</span>ï¼Œ
      æ¸…æ½” <span id="next-clean">--</span>ï¼Œ
      å–æ°´ <span id="next-drink">--</span>
    </div>

<!-- æ”¹ç‚ºå…©çµ„å€å¡Šï¼Œæ¯å€‹æŒ‰éˆ•é€£ panel -->
<div class="accordion-row">
  <div class="accordion-block left">
    <button class="accordion">éŠæˆ²èªªæ˜</button>
  <div class="panel">
    <p>é€™æ˜¯ä¸€å€‹å¯ä»¥å’Œå°é›ªäº’å‹•ï¼Œçµ¦ç‰ é¤µé£Ÿã€æ¸…æ½”ã€ç©è€ï¼Œä¸¦è®“å¥¹æ¢å¾©æ´»åŠ›ã€‚æ¯å€‹è¡Œå‹•éƒ½æœƒå½±éŸ¿å°é›ªçš„å¿ƒæƒ…ã€é£¢é¤“åº¦ã€å£æ¸´åº¦å’Œæ´»åŠ›ã€‚</p>
    <p>è«‹æ³¨æ„ï¼ŒæŸäº›è¡Œç‚ºæœ‰æ¬¡æ•¸é™åˆ¶ï¼Œæ¯éš”ä¸€æ®µæ™‚é–“æœƒè‡ªå‹•æ¢å¾©ã€‚</p>
    <p>è«‹å¥½å¥½ç…§é¡§å°é›ªï¼</p>
  </div>
</div>

  <div class="accordion-block right">
    <button class="accordion">æ³¨æ„äº‹é …</button>
  <div class="panel">
  <p>ä»¥ä¸‹è¡Œç‚ºå¯èƒ½æœƒå°è‡´éŠæˆ²è³‡æ–™è¢«æ¸…é™¤ï¼Œè«‹å°å¿ƒæ“ä½œï¼š</p>
    <p>ğŸš« æ¸…é™¤ç€è¦½å™¨çš„ Cookie æˆ–ç¶²é å„²å­˜ç©ºé–“</p>
    <p>ğŸš« ä½¿ç”¨ç„¡ç—•æ¨¡å¼ï¼ˆé—œé–‰ç€è¦½å™¨å¾Œè³‡æ–™æœƒéºå¤±ï¼‰</p>
    <p>ğŸš« æ›´æ›è£ç½®æˆ–ç€è¦½å™¨æœªåšè³‡æ–™å‚™ä»½</p>
    <p>ğŸš« ç€è¦½å™¨è¨­å®šç‚ºè‡ªå‹•æ¸…é™¤ç¶²ç«™è³‡æ–™</p>
    <p>ğŸš« åˆªé™¤ç€è¦½å™¨çš„ã€Œé‡ç½®ç¶²ç«™è³‡æ–™ã€æˆ–ã€Œæ¸…é™¤å¿«å–ã€</p>
  <p>âœ… å»ºè­°ï¼š</p>
    <p>âœ”ï¸ å®šæœŸå‚™ä»½</p>
    <p>âœ”ï¸ é¿å…ä½¿ç”¨ç„¡ç—•è¦–çª—ç©éŠæˆ²</p>
    <p>âœ”ï¸ ä½¿ç”¨åŒä¸€å°è£ç½®å’Œç€è¦½å™¨é€²è¡ŒéŠæˆ²</p>
  </div>
 </div>
</div>


    <div id="actions">
      <button id="play-btn">ç©è€ (<span id="play-count">5</span>)</button>
      <button id="feed-btn">é¤µé£Ÿ (10é‡‘å¹£)</button>
      <button id="clean-btn">æ¸…æ½” (<span id="clean-count">3</span>)</button>
      <button id="drink-btn">å–æ°´ (<span id="drink-count">5</span>)</button>
      <button id="sleep-btn">ç¡è¦º</button>
      <button id="coin-btn">æ¯æ—¥é‡‘å¹£+50</button>
      <button id="buy-coin-btn">é€é›ªç½ç½</button>
<div id="backup-area">
  <button id="backup-btn">ğŸ”å‚™ä»½è³‡æ–™</button>
  <input type="file" id="import-file" accept=".json" style="display: none;">
  <button id="import-btn">ğŸ“¥åŒ¯å…¥è³‡æ–™</button>
     </div>
</div>
  <p id="message"></p>


<!-- æ‘ºç–ŠæŒ‰éˆ•çš„ CSS å’Œ JavaScript -->
<style>
.accordion-row {
  display: flex;
  justify-content: space-between;
  gap: 1px;
}

  .accordion {
    display: inline-block;  /* âœ… è®“å®ƒåªä½”è‡ªèº«å¯¬åº¦ */
    background: linear-gradient(145deg, #ed9dd0, #f6cee8); /* æ¼¸è®Šè‰² */
    color: #333;
    cursor: pointer;
    padding: 5px 10px;  /* â†“ è®Šå°çš„é—œéµ */
    width: auto;       /* è®“å¯¬åº¦ä¾å…§å®¹è‡ªå‹•èª¿æ•´ */
    border: none;
    border-radius: 7px;
    text-align: left;
    outline: none;
    font-size: 12px;               /* â†“ å­—é«”è®Šå° */
    font-weight: 600;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    margin: 1px 2x; /* è®“æŒ‰éˆ•ä¹‹é–“ç•™ä¸€é»è·é›¢ */
  }


    /* æ´»å‹•ç‹€æ…‹å’Œæ‡¸åœç‹€æ…‹ */
  .accordion.active,
  .accordion:hover {
    background: linear-gradient(145deg, #9edceb, #70cce1);
    box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.7);
    transform: translateY(-1px);
}

  /* æ‘ºç–Šå…§å®¹ */
  .panel {
    padding: 15px;
    display: none;
    overflow: hidden;
    background-color: rgba(244, 246, 252, 0.2);
    border-left: 4px solid #70cce1;
    border-radius: 8px;
    margin-top: 10px;
    text-align: left;
  }
</style>

<script>
  const acc = document.getElementsByClassName("accordion");
  for (let i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function () {
      this.classList.toggle("active");
      const panel = this.nextElementSibling;
      if (panel && panel.classList.contains("panel")) {
        panel.style.display = panel.style.display === "block" ? "none" : "block";
      }
    });
  }
</script>
  </div>

<script>
  // å®šç¾©ä½ è¦å‚™ä»½çš„æ‰€æœ‰ Keyï¼ˆå¯ä¾å¯¦éš›éœ€æ±‚æ“´å……ï¼‰
  const backupKeys = [
    "coins",
    "hunger",
    "mood",
    "energy",
    "thirst",
    "playCount",
    "cleanCount",
    "drinkCount",
    "lastCoinTime",
    "otherGameData" // åŠ å…¥ä½ æœ‰ç”¨çš„ key
  ];

  // å‚™ä»½åŠŸèƒ½
  document.getElementById("backup-btn").addEventListener("click", () => {
    const data = {};

    backupKeys.forEach((key) => {
      const value = localStorage.getItem(key);
      if (value !== null) {
        data[key] = value;
      }
    });

    if (Object.keys(data).length === 0) {
      alert("âŒ æ²’æœ‰å¯å‚™ä»½çš„è³‡æ–™ï¼");
      return;
    }

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "game_backup_all.json";
    a.click();
    URL.revokeObjectURL(url);
  });

  // åŒ¯å…¥æŒ‰éˆ•é–‹å•Ÿæª”æ¡ˆé¸æ“‡å™¨
  document.getElementById("import-btn").addEventListener("click", () => {
    document.getElementById("import-file").click();
  });

  // åŒ¯å…¥åŠŸèƒ½
  document.getElementById("import-file").addEventListener("change", (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      try {
        const json = JSON.parse(e.target.result);
        let count = 0;

        for (const key in json) {
          localStorage.setItem(key, json[key]);
          count++;
        }

        alert(`âœ… åŒ¯å…¥å®Œæˆï¼Œç¸½å…±å¯«å…¥ ${count} ç­†è³‡æ–™ï¼`);
        location.reload();
      } catch (err) {
        alert("âŒ åŒ¯å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªæ˜¯æœ‰æ•ˆçš„ JSON å‚™ä»½æª”ã€‚");
      }
    };

    reader.readAsText(file);
  });
</script>


    <script>
  const pet = {
    name: "å°é›ª",
    mood: "é–‹å¿ƒ",
    hunger: 50,
    thirst: 40,
    energy: 70,
    exp: 0,
    level: 1,
    coins: 0,
    playCount: 5,
    cleanCount: 3,
    drinkCount: 5,
    moods: ["é–‹å¿ƒ", "ç„¡èŠ", "ç”Ÿæ°£", "ç–²å€¦", "èˆˆå¥®", "ä¼‘æ¯ä¸­"]
  };

  const moodDialogues = {
    "é–‹å¿ƒ": ["ä»Šå¤©çš„ä½ çœ‹èµ·ä¾†ä¸éŒ¯å–µï½", "å°é›ªå¿ƒæƒ…å¾ˆå¥½å–µï½"],
    "ç„¡èŠ": ["é™ªæˆ‘ç©å˜›ï½", "æˆ‘å€‘ä¾†ç©çƒçƒï¼Ÿ"],
    "ç”Ÿæ°£": ["å“¼ï¼é¤“äº†å•¦ï¼", "çµ¦æˆ‘ç½ç½å•¦ï¼Œä¸ç„¶å°é›ªè¦ç”Ÿæ°£å–”ï¼"],
    "ç–²å€¦": ["å°é›ªå›°äº†ï¼Œæƒ³ç¡è¦ºã€‚", "å°é›ªæƒ³èººå¹³..."],
    "èˆˆå¥®": ["ä»Šå¤©æ„Ÿè¦ºè¶…æ£’ï¼", "æˆ‘è¦æŠ±æŠ±ï¼"],
    "ä¼‘æ¯ä¸­": ["Zzz... èººåºŠåºŠæœ€æ£’äº†ï½"]
  };

  
  function requiredExp(level) {
    return 100 + (level - 1) * 50;
  }

  function gainExp(amount) {
    pet.exp += amount;
    while (pet.exp >= requiredExp(pet.level)) {
      pet.exp -= requiredExp(pet.level);
      pet.level++;
      showMessage(`${pet.name} å‡ç´šå•¦ï¼ç¾åœ¨æ˜¯ç­‰ç´š ${pet.level}ï¼`);
    }
    savePetData();
  }

  function showBubble(text) {
    const bubble = document.getElementById('mood-bubble');
    bubble.textContent = text;
    bubble.style.display = "block";
    setTimeout(() => {
      bubble.style.display = "none";
    }, 2500);
  }

  function showMessage(msg) {
    const message = document.getElementById("message");
    message.textContent = msg;
    setTimeout(() => {
      if (message.textContent === msg) message.textContent = "";
    }, 3000);
  }

  function updateStatus() {
    document.getElementById("pet-name").textContent = pet.name;
    document.getElementById("mood").textContent = pet.mood;
    document.getElementById("hunger-text").textContent = `${pet.hunger}/100`;
    document.getElementById("thirst-text").textContent = `${pet.thirst}/100`;
    document.getElementById("energy-text").textContent = `${pet.energy}/100`;
    document.getElementById("exp-text").textContent = `${pet.exp}/${requiredExp(pet.level)}`;
    document.getElementById("level").textContent = pet.level;
    document.getElementById("coins").textContent = pet.coins;
    document.getElementById("play-count").textContent = pet.playCount;
    document.getElementById("clean-count").textContent = pet.cleanCount;
    document.getElementById("drink-count").textContent = pet.drinkCount;

    document.getElementById("hunger-bar").style.width = `${pet.hunger}%`;
    document.getElementById("thirst-bar").style.width = `${pet.thirst}%`;
    document.getElementById("energy-bar").style.width = `${pet.energy}%`;
    document.getElementById("exp-bar").style.width = `${(pet.exp / requiredExp(pet.level)) * 100}%`;

    savePetData();
  }

   //é¡¯ç¤ºæ™‚é–“
  function updateClock() {
    const clock = document.getElementById('clock');
    const now = new Date();
    clock.textContent = now.toLocaleTimeString();
  }
  setInterval(updateClock, 1000);
  updateClock();

  // å–®ä½å¸¸æ•¸
const MINUTE = 60 * 1000;
const HOUR = 60 * MINUTE;

const restoreIntervals = {
  play: 1 * HOUR,      // æ¯ 1 å°æ™‚å¯æ¢å¾©ä¸€æ¬¡ç©è€æ¬¡æ•¸
  clean: 2 * HOUR,     // æ¯ 2 å°æ™‚å¯æ¢å¾©ä¸€æ¬¡æ¸…æ½”æ¬¡æ•¸
  drink: 30 * MINUTE   // æ¯ 30 åˆ†é˜å¯æ¢å¾©ä¸€æ¬¡å–æ°´æ¬¡æ•¸
};
function formatTime(seconds) {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = seconds % 60;

  if (h > 0) {
    return `${h}å°æ™‚ ${m}åˆ†`;
  } else if (m > 0) {
    return `${m}åˆ†é˜`;
  } else {
    return `${s}ç§’`;
  }
}


  let lastPlayRestore = Date.now();
  let lastCleanRestore = Date.now();
  let lastDrinkRestore = Date.now();

  // è®€å–å¯µç‰©è³‡æ–™èˆ‡æ¢å¾©æ™‚é–“
  function loadPetData() {
    const data = localStorage.getItem('petData');
    if (data) {
      const saved = JSON.parse(data);
      Object.assign(pet, saved);
    }
    lastPlayRestore = Number(localStorage.getItem('lastPlayRestore')) || Date.now();
    lastCleanRestore = Number(localStorage.getItem('lastCleanRestore')) || Date.now();
    lastDrinkRestore = Number(localStorage.getItem('lastDrinkRestore')) || Date.now();
  }

  // å„²å­˜å¯µç‰©è³‡æ–™èˆ‡æ¢å¾©æ™‚é–“
  function savePetData() {
    localStorage.setItem('petData', JSON.stringify(pet));
    localStorage.setItem('lastPlayRestore', lastPlayRestore);
    localStorage.setItem('lastCleanRestore', lastCleanRestore);
    localStorage.setItem('lastDrinkRestore', lastDrinkRestore);
  }

  function updateNextRestoreTimes() {
  const now = Date.now();
  const nextPlay = Math.max(0, Math.ceil((restoreIntervals.play - (now - lastPlayRestore)) / 1000));
  const nextClean = Math.max(0, Math.ceil((restoreIntervals.clean - (now - lastCleanRestore)) / 1000));
  const nextDrink = Math.max(0, Math.ceil((restoreIntervals.drink - (now - lastDrinkRestore)) / 1000));

  document.getElementById('next-play').textContent = nextPlay > 0 ? formatTime(nextPlay) : 'å¯ç”¨';
  document.getElementById('next-clean').textContent = nextClean > 0 ? formatTime(nextClean) : 'å¯ç”¨';
  document.getElementById('next-drink').textContent = nextDrink > 0 ? formatTime(nextDrink) : 'å¯ç”¨';
}


  setInterval(() => {
    const now = Date.now();

    if (pet.playCount < 5 && now - lastPlayRestore >= restoreIntervals.play) {
      pet.playCount++;
      lastPlayRestore = now;
    }
    if (pet.cleanCount < 3 && now - lastCleanRestore >= restoreIntervals.clean) {
      pet.cleanCount++;
      lastCleanRestore = now;
    }
    if (pet.drinkCount < 5 && now - lastDrinkRestore >= restoreIntervals.drink) {
      pet.drinkCount++;
      lastDrinkRestore = now;
    }
    updateNextRestoreTimes();
    updateStatus();
  }, 1000);

  function formatTime(seconds) {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = seconds % 60;

  let result = '';
  if (h > 0) result += `${h}å°æ™‚ `;
  if (m > 0 || h > 0) result += `${m}åˆ† `;
  result += `${s}ç§’`;

  return result.trim(); // å»é™¤å¤šé¤˜ç©ºç™½
}

  function canClaimDailyCoins() {
    const lastClaimDate = localStorage.getItem('lastClaimCoinsDate');
    const todayStr = new Date().toISOString().slice(0, 10);
    return lastClaimDate !== todayStr;
  }

  function claimDailyCoins() {
    if (canClaimDailyCoins()) {
      pet.coins += 50;
      showMessage("ç²å¾—50é‡‘å¹£ï¼");
      localStorage.setItem('lastClaimCoinsDate', new Date().toISOString().slice(0, 10));
      updateStatus();
    } else {
      alert("ä»Šå¤©å·²ç¶“é ˜éé‡‘å¹£å›‰ï¼Œè«‹æ˜å¤©å†ä¾†ï¼");
    }
  }

  document.getElementById("coin-btn").addEventListener("click", claimDailyCoins);

  document.getElementById("play-btn").addEventListener("click", () => {
    if (pet.playCount <= 0) {
      alert("ç©è€æ¬¡æ•¸ä¸è¶³ï¼Œè«‹ç¨å¾Œæ¢å¾©ï¼");
      return;
    }
    pet.playCount--;
    pet.mood = "èˆˆå¥®";
    pet.energy = Math.max(0, pet.energy - 10);
    pet.hunger = Math.min(100, pet.hunger + 10);
    pet.thirst = Math.min(100, pet.thirst + 10);
    gainExp(10);
    showBubble("ä¸€èµ·ç©çƒçƒï½");
    updateStatus();
  });

  document.getElementById("feed-btn").addEventListener("click", () => {
  if (pet.coins >= 10) {
    pet.coins -= 10;
    pet.hunger = Math.max(0, pet.hunger - 30);
    gainExp(10);
    showBubble("è¬è¬é¤µé£Ÿï¼Œå¥½é£½å–µï¼");
  } else {
    alert("âŒ é‡‘å¹£ä¸è¶³ï¼Œç„¡æ³•é¤µé£Ÿå°é›ªï¼");
  }
  updateStatus();
});

  document.getElementById("clean-btn").addEventListener("click", () => {
    if (pet.cleanCount <= 0) {
      alert("æ¸…æ½”æ¬¡æ•¸ä¸è¶³ï¼Œè«‹ç¨å¾Œæ¢å¾©ï¼");
      return;
    }
    pet.cleanCount--;
    pet.mood = "é–‹å¿ƒ";
    pet.energy = Math.min(100, pet.energy + 10);
    gainExp(10);
    showBubble("æ¸…æ½”å®Œçˆ½çˆ½çš„ï¼");
    updateStatus();
  });

  document.getElementById("drink-btn").addEventListener("click", () => {
    if (pet.drinkCount <= 0) {
      alert("å–æ°´æ¬¡æ•¸ä¸è¶³ï¼Œè«‹ç¨å¾Œæ¢å¾©ï¼");
      return;
    }
    pet.drinkCount--;
    pet.thirst = Math.max(0, pet.thirst - 30);
    pet.energy = Math.min(100, pet.energy + 5);
    gainExp(8);
    showBubble("å–æ°´å¥½èˆ’æœï¼");
    updateStatus();
  });

  let sleepCooldown = false;
  document.getElementById("sleep-btn").addEventListener("click", () => {
    if (sleepCooldown) {
      alert("å°é›ªæ­£åœ¨ç¡è¦ºï¼Œ10åˆ†é˜å¾Œå†ä¾†æ‰¾å¥¹å§ï¼");
      return;
    }
    pet.energy = 100;
    pet.mood = "ä¼‘æ¯ä¸­";
    showBubble("ç¡é£½é£½ç²¾ç¥å¥½ï¼");
    gainExp(15);
    updateStatus();

    sleepCooldown = true;
    setTimeout(() => {
      sleepCooldown = false;
      pet.mood = "é–‹å¿ƒ";
      updateStatus();
      showMessage("å°é›ªé†’ä¾†å•¦ï¼");
    }, 600000);
  });

function showRollingCat() {
  const cat = document.getElementById("rolling-cat");
  cat.style.display = "block";
  setTimeout(() => {
    cat.style.display = "none";
  }, 4000); // 4 ç§’å¾Œéš±è—
}


  document.getElementById("play-btn").addEventListener("click", () => {
      if (pet.playCount > 0) {
        pet.playCount--;
        showRollingCat();
        pet.mood = pet.moods[Math.floor(Math.random() * pet.moods.length)];
        gainExp(10);
        showBubble(moodDialogues[pet.mood][Math.floor(Math.random() * moodDialogues[pet.mood].length)]);
        updateStatus();
      } else {
        showMessage("å°é›ªä»Šå¤©ç©å¾—å¤ªå¤šäº†ï¼Œä¼‘æ¯ä¸€ä¸‹å§ï¼");
      }
    });

    document.getElementById("clean-btn").addEventListener("click", () => {
      if (pet.cleanCount > 0) {
        pet.cleanCount--;
        showMessage("å°é›ªè®Šå¾—æ›´ä¹¾å‡€äº†ï¼");
        updateStatus();
      } else {
        showMessage("å°é›ªéœ€è¦ä¼‘æ¯ï¼Œç­‰ä¸€ä¸‹å†æ¸…æ½”ï¼");
      }
    });

    document.getElementById("drink-btn").addEventListener("click", () => {
      if (pet.drinkCount > 0) {
        pet.drinkCount--;
        pet.thirst = 100;
        showMessage("å°é›ªå–æ°´å¾Œè®Šå¾—å¥½å¤šäº†ï¼");
        updateStatus();
      } else {
        showMessage("å°é›ªä»Šå¤©å–æ°´å¤ªå¤šäº†ï¼Œä¼‘æ¯ä¸€ä¸‹å§ï¼");
      }
    });

    document.getElementById("buy-coin-btn").addEventListener("click", () => {
  // å½ˆå‡ºæç¤ºæ¡†è©¢å•ç”¨æˆ¶æ˜¯å¦ç¢ºå®šè³¼è²·é‡‘å¹£
  const isConfirmed = confirm("ä½ é¡˜æ„é€å°é›ªä¸€ä»½ç½ç½å—ï¼Ÿä½œç‚ºæ„Ÿè¬ï¼Œå°é›ªæœƒé€ä½ 30é‡‘å¹£å–µï¼");


  if (isConfirmed) {
    pet.coins += 30;
    showMessage("è¬è¬ä½ çš„ç½ç½ï¼Œå°é›ªé€ä½ 30é‡‘å¹£å–µï¼");
    updateStatus();
    window.open("https://deerdonate.herokuapp.com/donation/%E8%B2%93%E5%B4%8E%E9%9B%AA", "_blank");
  } else {
    showMessage("ä¹Ÿæ²’é—œä¿‚ï¼Œå°é›ªé‚„æ˜¯æ„›ä½ å–µï½");
  }
});

  loadPetData();
  updateStatus();
  updateNextRestoreTimes();
  </script>
</body>
</html>
